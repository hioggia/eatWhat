<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<style>
		#mw thead td{background-color:green;color:white;text-align:center;}
		#mw thead td:nth-child(1){width:160px;}
		#mw thead td:nth-child(2){width:80px;}
		#mw thead td:nth-child(3){width:80px;}
		#mw thead td:nth-last-child(1){width:150px;}
		#mw tbody tr:nth-child(even) td{background-color:#eee;}
		#mw tbody input{width:40px;}
		#fs thead td{background-color:green;color:white;text-align:center;}
		#fs thead td:nth-child(1){width:140px;}
		#fs thead td:nth-last-child(1){width:340px;}
		#fs tbody tr:nth-child(even) td{background-color:#eee;}
		button{width:80px;height:28px;color:#002700;font-weight:700;font-size:1em;border-radius:6px;border:2px solid #245A37;background-image:linear-gradient(#A0E48A,#DBE6DD);margin-top:10px;}
		</style>
		<script>
		function c(nw,bw,mw,uw,ps1,ms1,ns1,cs1,us1,ps2,ms2,ns2,cs2,us2){
			//前四个参数所填为武器本数，后五个参数所填为UP倍数
			//nw普通攻刃，bw巴哈攻刃，mw马古纳攻刃，uw未知系列
			//ps属性召唤，ms马古纳召唤，ns课金方阵召唤，cs角色加护召唤，us神崎兰子
			var result = (1+(nw*(1+ns1+ns2))+(bw)+(1+cs1+cs2))*(1+(mw*(1+ms1+ms2)))*(1+(uw*(1+us1+us2)))*(1+ps1+ps2);
			return '倍数为：'+result;
		}
		var wList = {
			'普通攻刃(小)':[0,0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.10,0.106,0.112,0.118,0.124,0.13],
			'普通攻刃(中)':[0,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.10,0.11,0.12],
			'普通攻刃(大)':[0,0.06,0.07,0.08,0.09,0.10,0.11,0.12,0.13,0.14,0.15,0.156,0.162,0.168,0.174,0.18],
			'普通攻刃II(大)':[0,0.07,0.08,0.09,0.10,0.11,0.12,0.13,0.14,0.15,0.16,0.168,0.176,0.184,0.192,0.20],
			'巴哈攻刃(全攻)':[1,0.20,0.21,0.22,0.23,0.24,0.25,0.26,0.27,0.28,0.30],
			'巴哈攻刃(攻血)':[1,0.10,0.105,0.11,0.115,0.12,0.125,0.13,0.135,0.14,0.15],
			'玛古纳攻刃I(中)':[2,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.10,0.11,0.12,0.126,0.132,0.138,0.144,0.15],
			'玛古纳攻刃II(大)':[2,0.06,0.07,0.08,0.09,0.10,0.11,0.12,0.13,0.14,0.15,0.156,0.162,0.168,0.174,0.18],
			'未知系列ATK(中)':[3,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.10,0.11,0.12],
			'未知系列ATKII(大)':[3,0.06,0.07,0.08,0.09,0.10,0.11,0.12,0.13,0.14,0.15]
		};
		var sList = {
			'属性30':[0.3,0,0,0,0],
			'属性40':[0.4,0,0,0,0],
			'属性50':[0.5,0,0,0,0],
			'属性60':[0.6,0,0,0,0],
			'属性80':[0.8,0,0,0,0],
			'属性100':[1,0,0,0,0],
			'属性120':[1.2,0,0,0,0],
			'马古纳50':[0,0.5,0,0,0],
			'马古纳100':[0,1,0,0,0],
			'课金80':[0,0,0.8,0,0],
			'课金120':[0,0,1.2,0,0],
			'角色攻刃25':[0,0,0,0.25,0],
			'角色攻刃40':[0,0,0,0.4,0],
			'角色攻刃60':[0,0,0,0.6,0],
			'神崎兰子30':[0,0,0,0,0.3],
			'神崎兰子50':[0,0,0,0,0.5]
		};
		function calcResult(){
			var mainSummon = sList[document.querySelector('#ms select').value];
			var weapons = [0,0,0,0];
			Array.prototype.forEach.call(document.querySelectorAll('#mw tbody tr'),function(v,i){
				var m = v.children[0].querySelector('select').value,
					s = ~~v.children[1].querySelector('select').value,
					q = ~~v.children[2].querySelector('input').value;
				weapons[wList[m][0]] += wList[m][s]*q;
			});
			Array.prototype.forEach.call(document.querySelectorAll('#fs tbody tr'),function(v,i){
				if(v.children[0].querySelector('input').checked){
					var summonName = v.children[0].querySelector('label').textContent;
					var summon = sList[summonName];
					var arg = weapons.concat(mainSummon,summon);
					v.children[1].innerHTML = c.apply(null,arg);
				}
			});
		}
		function clearResult(){
			Array.prototype.forEach.call(document.querySelectorAll('#fs tbody tr'),function(v,i){
				v.children[1].innerHTML = '';
			});
		}
		function copyWeapon(){
			if(document.querySelectorAll('#mw tbody tr').length>=10){
				return;
			}
			var source = document.querySelector('#mw tbody tr').cloneNode(true);
			source.children[3].innerHTML = '<a href="javascript:void(0)">移除</a>';
			document.querySelector('#mw tbody').appendChild(source);
		}
		function weaponSLvManage(ev){
			if(ev.target.tagName.toUpperCase()=='SELECT'){
				if(ev.target.dataset.type=='m'){
					var l = wList[ev.target.value].length;
					var s = ev.target.parentNode.nextSibling.children[0];
					s.length=0;
					for(var i=1;i<l;i++){
						var option = new Option();
						option.text = i;
						s.add(option);
					}
				}
			}
		}
		function weaponManage(ev){
			if(ev.target.tagName.toUpperCase()=='A'){
				var n = ev.target.parentNode.parentNode;
				n.parentNode.removeChild(n);
			}
		}
		window.addEventListener('load',function(){
			var elMW = document.querySelector('#mw tbody'), elMS = document.querySelector('#ms select'), elFS = document.querySelector('#fs tbody');
			var row = document.createElement('tr');
			row.innerHTML = '<td><select data-type="m"></select></td><td><select></select></td><td><input type="number" value="1" /></td><td></td>';
			elMW.appendChild(row);
			var s1 = row.querySelector('select');
			for(var key in wList){
				var option = new Option();
				option.text = key;
				s1.add(option);
			}
			elMW.addEventListener('change',weaponSLvManage,false);
			elMW.addEventListener('click',weaponManage,false);
			var ev = document.createEvent('UIEvents');
			ev.initEvent('change',true,true);
			s1.dispatchEvent(ev);
			for(var key in sList){
				var option = new Option();
				option.text = key;
				elMS.add(option);
				var row = document.createElement('tr');
				row.innerHTML = '<td><label><input type="checkbox" />'+key+'</label></td><td></td>';
				elFS.appendChild(row);
			}
			document.querySelectorAll('button')[0].addEventListener('click',copyWeapon,false);
			document.querySelectorAll('button')[1].addEventListener('click',calcResult,false);
			document.querySelectorAll('button')[2].addEventListener('click',clearResult,false);
		},false);
		</script>
	</head>
	<body>
		<h1>你会带什么武器？</h1>
		<table id="mw"><thead><tr><td>技能</td><td>等级</td><td>数量</td><td></td></tr></thead><tbody></tbody></table>
		<button>增加</button>
		<h2>你的主召唤是？</h2>
		<p id="ms"><select></select></p>
		<h2>你会组的召唤有？</h2>
		<table id="fs"><thead><tr><td></td><td>结果</td></tr></thead><tbody></tbody></table>
		<button>计算</button> <button>清空</button>
	</body>
</html>